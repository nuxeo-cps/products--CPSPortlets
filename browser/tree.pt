<tal:block tal:define="folderItems python:request.get('folderItems')"
           tal:condition="folderItems">

<script type="text/javascript">
  function loadScript(id, script_filename) {
    var html_doc = document.getElementsByTagName('head').item(0);
    var js = document.createElement('script');
    js.setAttribute('language', 'javascript');
    js.setAttribute('type', 'text/javascript');
    js.setAttribute('src', script_filename);
    html_doc.appendChild(js);
    return false;
  }

  loadScript('prototype', 'prototype.js');
  loadScript('effect', 'effects.js');
  loadScript('treeview', '++resource++treenodeview.js');
</script>
<tal:block define="ds python: request.get('ds');
                   show_icons python:ds.get('show_icons', True);
                   show_icons python: int(show_icons);
                   linkclass python: show_icons and 'noicon' or None;
                   base_url python: request.get('cpsskins_base_url');
                   tree_roots python:[item for item in folderItems
                     if item.get('level') == 0];
                   root_has_nephew python:[1 for item in tree_roots if
                     context.getNodeChildren(folderItems, item)];
                   toggle_plus string:toggle_plus.png;
                   toggle_minus string:toggle_minus.png;">

<ul style="list-style-type: none!important; padding-left: 0px!important">
  <tal:block tal:repeat="node tree_roots">
    <li>
      <tal:block tal:define="dummy python:request.set('root', node['url'])">
        <div tal:content="structure context/getTreeviewNode">
        Dynamic treeview
        </div>
      </tal:block>
    </li>
  </tal:block>
</ul>
<script type="text/javascript" tal:content="string:
  var treeview_editor = new CPSTreeViewEditor('nodeloader', 'getTreeviewBranch', ${show_icons});">
</script>

</tal:block>
</tal:block>
