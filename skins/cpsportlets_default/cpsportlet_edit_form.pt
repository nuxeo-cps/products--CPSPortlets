<tal:block define="emptybody python: 1">
<metal:block define-macro="edit_form">
  <metal:block use-macro="here/main_template_popup/macros/master|here/main_template/macros/master">
  <metal:block fill-slot="css_slot">
    <metal:block define-macro="widgets_javascript">

    <!-- XXX this has to move to CPSSchemas -->
    <style type="text/css"
      tal:content="string:@import url(${base_url}calendar-win2k-1.css);"></style>
    <script type="text/javascript" src="calendar.js"
      tal:attributes="src string:${base_url}calendar.js"></script>
    <script type="text/javascript" src="lang/calendar-en.js"
      tal:define="local cpsmcat/get_selected_language"
      tal:attributes="src string:${base_url}lang/calendar-${local}.js"></script>
    <script type="text/javascript" src="calendar-setup.js"
      tal:attributes="src string:${base_url}calendar-setup.js"></script>

    <!-- XXX this has to move to CPSSchemas -->
    <script type="text/javascript">
    <!--
     function popup_rte(input_id, label_edit) {
       var args, value
       value = document.getElementById(input_id).value;
       args='?input_id='+input_id+'&label_edit='+escape(label_edit);
       popup = window.open('popup_rte_form'+args, input_id, 'toolbar=0, scrollbars=0, location=0, statusbar=0, menubar=0, resizable=0, dependent=1, width=640, height=480')
       if(!popup.opener)
         popup.opener = window;
       return false;
   }
   //-->
   </script>
   </metal:block>
  </metal:block>

  <metal:block fill-slot="main"
   tal:define="layout_id layout_id|nothing;
               metadata python: layout_id == 'metadata';
               res python:here.editCPSPortlet(layout_id=layout_id, REQUEST=request);
               rendered_main python: res[0];
               portal_status_message python: res[1];
               error python: res[2]">

    <div style="text-align: right"
     tal:define="metadata python: layout_id == 'metadata'">
       <a tal:condition="not:metadata" i18n:translate="action_metadata"
        href="cpsportlet_metadata">metadata</a>
       <a tal:condition="metadata" i18n:translate="button_back"
        href="cpsportlet_edit_form">back</a>
    </div>

    <h1>
      <img tal:replace="structure python:here.getImgTag('/'+here.getIcon(), base_url='')" />
      <tal:block i18n:translate="_Edit_">Edit</tal:block> 
      "<tal:block replace="here/title_or_id" />"
    </h1>
    <div tal:condition="error"
         tal:replace="structure rendered_main" />
    <div tal:condition="not:error"
         tal:replace="structure python: here.render(layout_mode='edit', layout_id=layout_id,  context_obj=here)" />

    <form action="" style="text-align: center">
      <input class="standalone" type="submit" 
       onclick="window.opener.location.reload();window.close()"
       value="button_close" i18n:attributes="value" />
    </form>
  </metal:block>

</metal:block>
</metal:block>
</tal:block>
